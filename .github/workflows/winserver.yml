name: VNC via Cloudflare Quick Tunnel

on: [workflow_dispatch]

jobs:
  vnc:
    runs-on: windows-latest
    timeout-minutes: 360

    steps:
    - name: Install VNC
      run: |
        Invoke-WebRequest -Uri "https://www.tightvnc.com/download/2.8.81/tightvnc-2.8.81-gpl-setup-64bit.msi" -OutFile "tightvnc.msi"
        Start-Process msiexec -ArgumentList "/i tightvnc.msi /quiet /norestart" -Wait
        Start-Sleep -Seconds 10
        $vncPath = "C:\Program Files\TightVNC\tvnserver.exe"
        & "$vncPath" -service -start
        Start-Sleep -Seconds 5
        & "$vncPath" -controlservice -password Pass123!

    - name: Start Quick Tunnel
      run: |
        Invoke-WebRequest -Uri "https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-windows-amd64.exe" -OutFile "cloudflared.exe"
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º quick tunnel (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)
        $tunnelJob = Start-Job -ScriptBlock {
            $process = Start-Process -FilePath ".\cloudflared.exe" -ArgumentList "tunnel --url tcp://localhost:5900" -PassThru -NoNewWindow
            return $process.Id
        }
        
        # –ñ–¥–µ–º –∏ –ø–æ–ª—É—á–∞–µ–º URL
        Start-Sleep -Seconds 10
        
        # Cloudflared —Å–∞–º –ø–æ–∫–∞–∂–µ—Ç URL –≤ –∫–æ–Ω—Å–æ–ª–∏
        Write-Host "================================================"
        Write-Host "üöÄ QUICK TUNNEL STARTED"
        Write-Host "Check logs above for connection URL"
        Write-Host "Format: random-string.try.cloudflare.com"
        Write-Host "VNC Password: Pass123!"
        Write-Host "================================================"
        
        # –ñ–¥–µ–º 6 —á–∞—Å–æ–≤
        Start-Sleep -Seconds 21600
